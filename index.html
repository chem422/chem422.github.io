<!DOCTYPE html>
<html>
<head>
  <title>Duck Hunt Rocket Launcher</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(#87CEEB, #4682B4); }
    canvas { border: 2px solid #333; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
    .hud { position: absolute; top: 10px; left: 10px; right: 10px; color: white; font-family: 'Press Start 2P', cursive; font-size: 14px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
    .score { position: absolute; top: 10px; right: 20px; font-size: 20px; }
    .game-over { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 20px; border-radius: 10px; text-align: center; font-family: 'Press Start 2P', cursive; }
    .power-up-info { position: absolute; top: 40px; left: 10px; color: yellow; font-family: 'Press Start 2P', cursive; font-size: 12px; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
    .shop-button { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); color: yellow; font-family: 'Press Start 2P', cursive; font-size: 14px; cursor: pointer; }
  </style>
</head>
<body>
<div class="hud">
  <div>Duck Hunt: Rocket Frenzy</div>
  <div style="font-size: 10px; margin-top: 5px;">Click to shoot | HP: <span id="player-hp">100</span></div>
  <div class="power-up-info" id="power-up-info"></div>
</div>
<div class="shop-button" id="shop-button">Shop</div>
<script>
let ducks = [];
let rockets = [];
let explosions = [];
let scoreTexts = [];
let powerUps = [];
let drones = [];
let boss = null;
let score = 0;
let playerHP = 100;
let maxHP = 100;
let hpUpgradeLevel = 0;
let ctx;
let gameOver = false;
let bossDroneTimer = 0;
let gameOverDiv = null;
let activePowerUp = { type: null, timer: 0 };
let duckImg, bossImg;
let fireCooldown = 0;
let powerUpSpawnInterval = 10000;
let shopOpen = false;

function preload() {
  try {
    duckImg = loadImage('image_processing20210615-6360-1umka5z.png');
    bossImg = loadImage('boss.png');
  } catch (e) {
    console.log('Image loading error:', e);
  }
}

function setup() {
  createCanvas(800, 600);
  frameRate(60);
  ctx = new (window.AudioContext || window.webkitAudioContext)();
  for (let i = 0; i < 8; i++) {
    spawnDuck();
  }
  setInterval(spawnPowerUp, 10000);
  setInterval(spawnDrone, 10000);
  document.getElementById('shop-button').addEventListener('click', toggleShop);
}

function toggleShop() {
  shopOpen = !shopOpen;
  if (shopOpen) {
    document.getElementById('shop-button').textContent = 'Close Shop';
  } else {
    document.getElementById('shop-button').textContent = 'Shop';
  }
}

function draw() {
  if (gameOver) {
    if (!gameOverDiv) drawGameOver();
    return;
  }
  // Gradient background
  let c1 = color(135, 206, 235);
  let c2 = color(70, 130, 180);
  for (let y = 0; y < height; y++) {
    let n = map(y, 0, height, 0, 1);
    let newColor = lerpColor(c1, c2, n);
    stroke(newColor);
    line(0, y, width, y);
  }
  if (shopOpen) {
    // Draw shop menu
    fill(0, 0, 0, 200);
    rect(width / 2 - 200, height / 2 - 150, 400, 300);
    fill(255);
    textFont('Press Start 2P');
    textSize(16);
    textAlign(CENTER);
    text('Shop', width / 2, height / 2 - 120);
    textSize(12);
    text('HP Upgrade (' + (10 + 10 * hpUpgradeLevel) + ' points)', width / 2, height / 2 - 80);
    text('HP Restore (10 points)', width / 2, height / 2 - 50);
    text('Close', width / 2, height / 2 + 100);
    return; // Pause game
  }
  // Update boost timer
  if (activePowerUp.timer > 0) {
    activePowerUp.timer--;
    if (activePowerUp.timer <= 0) {
      activePowerUp.type = null;
      document.getElementById('power-up-info').textContent = '';
    }
  }
  // Check boss spawn
  if (score >= 100 && score % 100 === 0 && !boss) {
    boss = new BossDuck();
  }
  // Draw and update ducks
  for (let i = ducks.length - 1; i >= 0; i--) {
    let duck = ducks[i];
    duck.update();
    duck.show();
    if (duck.offScreen()) {
      ducks.splice(i, 1);
      spawnDuck();
    }
  }
  // Draw and update drones
  for (let i = drones.length - 1; i >= 0; i--) {
    let drone = drones[i];
    drone.update();
    drone.show();
    if (drone.offScreen()) {
      drones.splice(i, 1);
    } else if (drone.hitsPlayer()) {
      playerHP -= 10;
      document.getElementById('player-hp').textContent = playerHP;
      drones.splice(i, 1);
      if (playerHP <= 0) {
        gameOver = true;
        playGameOverSound();
      }
    }
  }
  // Draw and update boss
  if (boss) {
    boss.update();
    boss.show();
    bossDroneTimer++;
    if (bossDroneTimer >= 180) { // 3 seconds at 60 FPS
      for (let i = 0; i < 4; i++) {
        drones.push(new Drone(boss.x, boss.y));
      }
      bossDroneTimer = 0;
    }
    if (boss.hp <= 0) {
      score += 100;
      explosions.push(new Explosion(boss.x, boss.y));
      scoreTexts.push(new ScoreText(boss.x, boss.y));
      spawnPowerUp();
      spawnPowerUp();
      boss = null;
      bossDroneTimer = 0;
    }
  }
  // Draw and update rockets
  for (let i = rockets.length - 1; i >= 0; i--) {
    let rocket = rockets[i];
    rocket.update();
    rocket.show();
    if (rocket.offScreen()) {
      rockets.splice(i, 1);
    } else {
      // Check collisions with ducks
      for (let j = ducks.length - 1; j >= 0; j--) {
        if (rocket.hits(ducks[j])) {
          explosions.push(new Explosion(ducks[j].x, ducks[j].y));
          playExplosionSound();
          score += 10;
          scoreTexts.push(new ScoreText(ducks[j].x, ducks[j].y));
          ducks.splice(j, 1);
          rockets.splice(i, 1);
          spawnDuck();
          break;
        }
      }
      // Check collisions with drones
      for (let j = drones.length - 1; j >= 0; j--) {
        if (rocket.hits(drones[j])) {
          explosions.push(new Explosion(drones[j].x, drones[j].y));
          playDroneHitSound();
          score += 5;
          scoreTexts.push(new ScoreText(drones[j].x, drones[j].y));
          drones.splice(j, 1);
          rockets.splice(i, 1);
          break;
        }
      }
      // Check collisions with boss
      if (boss && rocket.hits(boss)) {
        boss.hp -= 5;
        playBossHitSound();
        rockets.splice(i, 1);
      }
    }
  }
  // Draw and update explosions
  for (let i = explosions.length - 1; i >= 0; i--) {
    explosions[i].update();
    explosions[i].show();
    if (explosions[i].isDone()) {
      explosions.splice(i, 1);
    }
  }
  // Draw and update score texts
  for (let i = scoreTexts.length - 1; i >= 0; i--) {
    scoreTexts[i].update();
    scoreTexts[i].show();
    if (scoreTexts[i].isDone()) {
      scoreTexts.splice(i, 1);
    }
  }
  // Draw and update power ups
  for (let i = powerUps.length - 1; i >= 0; i--) {
    powerUps[i].update();
    powerUps[i].show();
    if (powerUps[i].offScreen()) {
      powerUps.splice(i, 1);
    }
  }
  // Draw rocket launcher
  fill(100);
  rect(mouseX - 20, height - 40, 40, 20);
  fill(255, 0, 0);
  triangle(mouseX - 10, height - 40, mouseX + 10, height - 40, mouseX, height - 60);
  // Draw score
  fill(0);
  textSize(20);
  text(`Score: ${score}`, 10, 30);
}

function mousePressed() {
  if (shopOpen) {
    // Check for shop purchases
    if (mouseX > width / 2 - 200 && mouseX < width / 2 + 200 && mouseY > height / 2 - 100 && mouseY < height / 2 - 70) {
      let price = 10 + 10 * hpUpgradeLevel;
      if (score >= price) {
        score -= price;
        hpUpgradeLevel++;
        maxHP += 20;
        playerHP = maxHP;
        document.getElementById('player-hp').textContent = playerHP;
      }
    } else if (mouseX > width / 2 - 200 && mouseX < width / 2 + 200 && mouseY > height / 2 - 70 && mouseY < height / 2 - 40) {
      if (score >= 10) {
        score -= 10;
        playerHP = maxHP;
        document.getElementById('player-hp').textContent = playerHP;
      }
    } else if (mouseX > width / 2 - 200 && mouseX < width / 2 + 200 && mouseY > height / 2 + 80 && mouseY < height / 2 + 110) {
      shopOpen = false;
      document.getElementById('shop-button').textContent = 'Shop';
    }
    return;
  }
  rockets.push(new Rocket(mouseX, height - 40));
}

</script>
</body>
</html>
